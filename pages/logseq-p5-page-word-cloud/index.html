<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>LogSeq P5 Page Word Cloud | John's Log Blog</title><meta name=keywords content><meta name=description content="What I decided to go for though was simply getting a wordcloud into a p5 plugin from my [[Logseq]] page entries. Clicking the graph button creates a word cloud for all times I&rsquo;ve linked to that page. That&rsquo;s really nice because in logseq, essentially anything can be a page, and I have a lot of pages for specific parts of my life:
  [[journal]] entries
  [[Dreams]] for my dream journals"><meta name=author content="John Bezark"><link rel=canonical href=https://logblog.github.io/pages/logseq-p5-page-word-cloud/><link crossorigin=anonymous href=/assets/css/stylesheet.min.49b1c3611e5e823e974d0b9b3e1101617fce26c004757161abb1a1e4af3ff85c.css integrity="sha256-SbHDYR5egj6XTQubPhEBYX/OJsAEdXFhq7Gh5K8/+Fw=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://logblog.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://logblog.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://logblog.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://logblog.github.io/apple-touch-icon.png><link rel=mask-icon href=https://logblog.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.97.3"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="LogSeq P5 Page Word Cloud"><meta property="og:description" content="What I decided to go for though was simply getting a wordcloud into a p5 plugin from my [[Logseq]] page entries. Clicking the graph button creates a word cloud for all times I&rsquo;ve linked to that page. That&rsquo;s really nice because in logseq, essentially anything can be a page, and I have a lot of pages for specific parts of my life:
  [[journal]] entries
  [[Dreams]] for my dream journals"><meta property="og:type" content="article"><meta property="og:url" content="https://logblog.github.io/pages/logseq-p5-page-word-cloud/"><meta property="article:section" content="pages"><meta property="article:published_time" content="2022-04-07T00:00:00+00:00"><meta property="article:modified_time" content="2022-04-07T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="LogSeq P5 Page Word Cloud"><meta name=twitter:description content="What I decided to go for though was simply getting a wordcloud into a p5 plugin from my [[Logseq]] page entries. Clicking the graph button creates a word cloud for all times I&rsquo;ve linked to that page. That&rsquo;s really nice because in logseq, essentially anything can be a page, and I have a lot of pages for specific parts of my life:
  [[journal]] entries
  [[Dreams]] for my dream journals"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Pages","item":"https://logblog.github.io/pages/"},{"@type":"ListItem","position":3,"name":"LogSeq P5 Page Word Cloud","item":"https://logblog.github.io/pages/logseq-p5-page-word-cloud/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"LogSeq P5 Page Word Cloud","name":"LogSeq P5 Page Word Cloud","description":"What I decided to go for though was simply getting a wordcloud into a p5 plugin from my [[Logseq]] page entries. Clicking the graph button creates a word cloud for all times I\u0026rsquo;ve linked to that page. That\u0026rsquo;s really nice because in logseq, essentially anything can be a page, and I have a lot of pages for specific parts of my life:\n  [[journal]] entries\n  [[Dreams]] for my dream journals","keywords":[],"articleBody":"What I decided to go for though was simply getting a wordcloud into a p5 plugin from my [[Logseq]] page entries. Clicking the graph button creates a word cloud for all times I’ve linked to that page. That’s really nice because in logseq, essentially anything can be a page, and I have a lot of pages for specific parts of my life:\n  [[journal]] entries\n  [[Dreams]] for my dream journals\n  emotional concepts like when I’m [[hard on myself]]\n  and all sorts of stuff!\n  Here’s the GitHub Repo\nHow I did it   I found this decent example for making a wordcloud in p5 with rita,js\n  [[p5 js]] [[Language analysis]] Examples\n Wordcloud    let params = {  ignoreStopWords: true,  ignoreCase: true,  ignorePunctuation: true  }; let counts = RiTa.concordance(lines.join(\" \"),  params); let total = totalValues(counts); + The [[logseq]] api is fairly straightforward and allows you to create plugins that are essentially just iframes that can be opened and closed. + There's an index.js file with this stuff +  /** * User model */ function createModel () {  return {  openSketch () {  // logseq.App.showMsg('hello, mind map')  logseq.showMainUI()  },  } }  function main () {  logseq.provideStyle(` @import url(\"https://at.alicdn.com/t/font_2409735_lkeod9mm2ej.css\"); `)   logseq.setMainUIInlineStyle({  // position: 'fixed',  // zIndex: 12,  })   logseq.App.registerUIItem('pagebar', {  key: 'another-open-mind',  template: `   `,  })   // main ui  // const root = document.querySelector('#app')  const btnClose = document.createElement('button')  const displaySketch = document.createElement('div')   // events  displaySketch.id = 'sketchey'    // displaySketch.classList.add('mind-display', 'hidden')  btnClose.textContent = 'CLOSE'  btnClose.classList.add('close-btn')   btnClose.addEventListener('click', () = {  logseq.hideMainUI()  }, false)   document.addEventListener('keydown', function (e) {  if (e.keyCode === 27) {  logseq.hideMainUI()  p.noLoop()  }  }, false)   logseq.on('ui:visible:changed', async ({ visible }) = {  if (!visible) {  displaySketch.classList.add('hidden')  displaySketch.innerHTML = ''  return  }   let currentPage = await logseq.Editor.getCurrentPage()   let backlinkedBlocks = await logseq.DB.datascriptQuery(`[:find (pull ?b [*]) :where [?b :block/path-refs [:block/name \"`+currentPage.name+`\"]] [?page :block/original-name ?name]] `)  // console.log(backlinkedBlocks)  let textHonk = []  for (const blocky of backlinkedBlocks) {  textHonk.push(blocky[0].content)   }  // const blocks = await logseq.Editor.getCurrentPageBlocksTree()  initSketch(displaySketch, btnClose, textHonk)  })   // mount to root  // root.append(displaySketch) }  /** * @param el * @param btnClose * @param data */ function initSketch (el, btnClose, data) {     if(!p){p = new p5(sketch, 'sketchey');}  p.updateWordsToDraw(data)  p.loop()   // let mind = new MindElixir(options)  // mind.init()   const patchRightBottomBar = () = {  // const barWrap = document.querySelector('toolbar.rb')  // barWrap.appendChild(btnClose)  }   setTimeout(() = {  patchRightBottomBar()  // mind.initSide()  // el.classList.remove('hidden')  }, 16) }  // bootstrap logseq.ready(createModel(), main).catch(console.error)  + And then a sketch.js with this stuff + Notably, p5 is in instance mode so it can attach nicely to the div that logseq makes.    The real tricky part was figuring out how to get logseq to query itself for all the blocks with the correct pages\n The database is built in datomic/datascript and the syntax for that query was     let backlinkedBlocks = await logseq.DB.datascriptQuery(`[:find (pull ?b [*]) :where [?b :block/path-refs [:block/name \"`+currentPage.name+`\"]] [?page :block/original-name ?name]] `)  + I don't realllly know how that worked, but it did!   There’s still some cleaning up to do with it, but I’m already finding it a really interesting tool!  Next Steps   https://t.co/vq3ii3p3My\n  Nearley\n  ","wordCount":"511","inLanguage":"en","datePublished":"2022-04-07T00:00:00Z","dateModified":"2022-04-07T00:00:00Z","author":{"@type":"Person","name":"John Bezark"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://logblog.github.io/pages/logseq-p5-page-word-cloud/"},"publisher":{"@type":"Organization","name":"John's Log Blog","logo":{"@type":"ImageObject","url":"https://logblog.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://logblog.github.io accesskey=h title="John's Log Blog (Alt + H)">John's Log Blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://logblog.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://logblog.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://logblog.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://logblog.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>LogSeq P5 Page Word Cloud</h1><div class=post-meta><span title="2022-04-07 00:00:00 +0000 UTC">April 7, 2022</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;John Bezark</div></header><div class=post-content><p>What I decided to go for though was simply getting a wordcloud into a p5 plugin from my [[Logseq]] page entries. Clicking the graph button creates a word cloud for all times I&rsquo;ve linked to that page. That&rsquo;s really nice because in logseq, essentially anything can be a page, and I have a lot of pages for specific parts of my life:</p><ul><li><p>[[journal]] entries</p></li><li><p>[[Dreams]] for my dream journals</p></li><li><p>emotional concepts like when I&rsquo;m [[hard on myself]]</p></li><li><p>and all sorts of stuff!</p></li></ul><p>Here&rsquo;s the <a href=https://github.com/bezark/p5-logseq-wordcloud>GitHub Repo</a></p><h2 id=how-i-did-it>How I did it<a hidden class=anchor aria-hidden=true href=#how-i-did-it>#</a></h2><ul><li><p>I found this decent example for making a wordcloud in p5 with rita,js</p></li><li><p>[[p5 js]] [[Language analysis]] Examples</p><ul><li><a href=https://editor.p5js.org/fauthereea/sketches/aKByHsRr2>Wordcloud</a></li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>params</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ignoreStopWords</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ignoreCase</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ignorePunctuation</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>counts</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>RiTa</span>.<span style=color:#a6e22e>concordance</span>(<span style=color:#a6e22e>lines</span>.<span style=color:#a6e22e>join</span>(<span style=color:#e6db74>&#34; &#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>params</span>); 
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>total</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>totalValues</span>(<span style=color:#a6e22e>counts</span>);
</span></span></code></pre></div><pre><code>+ The [[logseq]] api is fairly straightforward and allows you to create plugins that are essentially just iframes that can be opened and closed.


  + There's an index.js file with this stuff


    + 
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * User model
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>createModel</span> () {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>openSketch</span> () {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// logseq.App.showMsg(&#39;hello, mind map&#39;)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>logseq</span>.<span style=color:#a6e22e>showMainUI</span>()
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>main</span> () {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>logseq</span>.<span style=color:#a6e22e>provideStyle</span>(<span style=color:#e6db74>`
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    @import url(&#34;https://at.alicdn.com/t/font_2409735_lkeod9mm2ej.css&#34;);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  `</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>logseq</span>.<span style=color:#a6e22e>setMainUIInlineStyle</span>({
</span></span><span style=display:flex><span>    <span style=color:#75715e>// position: &#39;fixed&#39;,
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// zIndex: 12,
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>logseq</span>.<span style=color:#a6e22e>App</span>.<span style=color:#a6e22e>registerUIItem</span>(<span style=color:#e6db74>&#39;pagebar&#39;</span>, {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>key</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;another-open-mind&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>template</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     &lt;a data-on-click=&#34;openSketch&#34; title=&#34;open sketch&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>       &lt;i class=&#34;iconfont icon-icons-mind_map&#34; style=&#34;font-size: 18px; line-height: 1em;&#34;&gt;&lt;/i&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>     &lt;/a&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    `</span>,
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// main ui
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// const root = document.querySelector(&#39;#app&#39;)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>btnClose</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#39;button&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>displaySketch</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#39;div&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// events
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>displaySketch</span>.<span style=color:#a6e22e>id</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;sketchey&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// displaySketch.classList.add(&#39;mind-display&#39;, &#39;hidden&#39;)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>btnClose</span>.<span style=color:#a6e22e>textContent</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;CLOSE&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>btnClose</span>.<span style=color:#a6e22e>classList</span>.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#39;close-btn&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>btnClose</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;click&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>logseq</span>.<span style=color:#a6e22e>hideMainUI</span>()
</span></span><span style=display:flex><span>  }, <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  document.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;keydown&#39;</span>, <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>e</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>keyCode</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>27</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>logseq</span>.<span style=color:#a6e22e>hideMainUI</span>()
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>noLoop</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }, <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>logseq</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;ui:visible:changed&#39;</span>, <span style=color:#66d9ef>async</span> ({ <span style=color:#a6e22e>visible</span> }) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>visible</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>displaySketch</span>.<span style=color:#a6e22e>classList</span>.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#39;hidden&#39;</span>)
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>displaySketch</span>.<span style=color:#a6e22e>innerHTML</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>currentPage</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>logseq</span>.<span style=color:#a6e22e>Editor</span>.<span style=color:#a6e22e>getCurrentPage</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>backlinkedBlocks</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>logseq</span>.<span style=color:#a6e22e>DB</span>.<span style=color:#a6e22e>datascriptQuery</span>(<span style=color:#e6db74>`[:find (pull ?b [*])
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :where
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    [?b :block/path-refs [:block/name &#34;`</span><span style=color:#f92672>+</span><span style=color:#a6e22e>currentPage</span>.<span style=color:#a6e22e>name</span><span style=color:#f92672>+</span><span style=color:#e6db74>`&#34;]]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    [?page :block/original-name ?name]]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>`</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e>// console.log(backlinkedBlocks)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>textHonk</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>blocky</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>backlinkedBlocks</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>textHonk</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>blocky</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>content</span>)
</span></span><span style=display:flex><span>     
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// const blocks = await logseq.Editor.getCurrentPageBlocksTree()
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>initSketch</span>(<span style=color:#a6e22e>displaySketch</span>, <span style=color:#a6e22e>btnClose</span>, <span style=color:#a6e22e>textHonk</span>)
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// mount to root
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// root.append(displaySketch)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param el
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param btnClose
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param data
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>initSketch</span> (<span style=color:#a6e22e>el</span>, <span style=color:#a6e22e>btnClose</span>, <span style=color:#a6e22e>data</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>p</span>){<span style=color:#a6e22e>p</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>(<span style=color:#a6e22e>sketch</span>, <span style=color:#e6db74>&#39;sketchey&#39;</span>);}
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>updateWordsToDraw</span>(<span style=color:#a6e22e>data</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>loop</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// let mind = new MindElixir(options)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// mind.init()
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>patchRightBottomBar</span> <span style=color:#f92672>=</span> () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// const barWrap = document.querySelector(&#39;toolbar.rb&#39;)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// barWrap.appendChild(btnClose)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>setTimeout</span>(() =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>patchRightBottomBar</span>()
</span></span><span style=display:flex><span>    <span style=color:#75715e>// mind.initSide()
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// el.classList.remove(&#39;hidden&#39;)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }, <span style=color:#ae81ff>16</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// bootstrap
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>logseq</span>.<span style=color:#a6e22e>ready</span>(<span style=color:#a6e22e>createModel</span>(), <span style=color:#a6e22e>main</span>).<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>)
</span></span></code></pre></div><pre><code>  + And then a sketch.js with this stuff

+ Notably, p5 is in instance mode so it can attach nicely to the div that logseq makes.
</code></pre><ul><li><p>The real tricky part was figuring out how to get logseq to query itself for all the blocks with the correct pages</p><ul><li>The database is built in datomic/datascript and the syntax for that query was</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>   <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>backlinkedBlocks</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>logseq</span>.<span style=color:#a6e22e>DB</span>.<span style=color:#a6e22e>datascriptQuery</span>(<span style=color:#e6db74>`[:find (pull ?b [*])
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    :where
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    [?b :block/path-refs [:block/name &#34;`</span><span style=color:#f92672>+</span><span style=color:#a6e22e>currentPage</span>.<span style=color:#a6e22e>name</span><span style=color:#f92672>+</span><span style=color:#e6db74>`&#34;]]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    [?page :block/original-name ?name]]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>`</span>)
</span></span></code></pre></div><pre><code>  + I don't realllly know how that worked, but it did!
</code></pre><ul><li>There&rsquo;s still some cleaning up to do with it, but I&rsquo;m already finding it a really interesting tool!</li></ul><h1 id=next-steps>Next Steps<a hidden class=anchor aria-hidden=true href=#next-steps>#</a></h1><ul><li><p><a href=https://t.co/vq3ii3p3My>https://t.co/vq3ii3p3My</a></p></li><li><p><a href=https://nearley.js.org/>Nearley</a></p></li></ul></div><aside><h4>No notes link to this note</h4></aside><aside class=related></aside><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://logblog.github.io>John's Log Blog</a></span><br><span>Powered by
<a href=https://github.com/sawhney17/logseq-schrodinger rel=noopener target=_blank>Logseq Schrödinger</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>